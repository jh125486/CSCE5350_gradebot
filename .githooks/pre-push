#!/bin/bash
# Pre-push hook to run tests and linting before allowing a push
# This ensures that code pushed to remote passes all quality checks

set -e

echo "🔍 Running pre-push checks..."
echo ""

# Get the repository root directory
REPO_ROOT=$(git rev-parse --show-toplevel)
cd "$REPO_ROOT"

# Run linting
echo "📝 Running linting checks..."
if ! make lint; then
    echo ""
    echo "❌ Linting failed. Please fix the issues before pushing."
    echo "   You can run 'make lint' to see the errors."
    exit 1
fi

echo "✅ Linting passed"
echo ""

# Run tests with race detection
echo "🧪 Running tests with race detection..."
if ! make test; then
    echo ""
    echo "❌ Tests failed. Please fix the failing tests before pushing."
    echo "   You can run 'make test' to see the failures."
    exit 1
fi

echo "✅ All tests passed"
echo ""
echo "✨ All pre-push checks passed! Proceeding with push..."
echo ""

exit 0
